function Emily(){var d={},c={},a={},b=false;this.declare=function(a,b,g){if(typeof b=="string"&&typeof g=="function")g.prototype=new d[b](this);else if(typeof b=="function")g=b;else return false;c[a]=new g(this);return d[a]=g};this.require=function(e){return b&&a[e]||c[e]||this.require("Tools").getGlobal()[e]};this.setIsolationMode=function(a){b=a};this.getIsolationMode=function(){return b};this.inject=function(b,c){a[b]=c}}Emily=new Emily;
Emily.declare("Observable",function(){function d(){var c={};this.watch=function(a,b,e){if(typeof a=="string"&&typeof b=="function"){var f=c[a]=c[a]||[];observer=[b,e];f.push(observer);return[a,f.indexOf(observer)]}else return false};this.unwatch=function(a){var b=a[0],a=a[1];return c[b]&&c[b][a]?(c[b][a]=null,true):false};this.notify=function(a,b){var e=c[a],f;if(e){for(f=e.length;f--;)e[f]&&e[f][0].call(e[f][1]||null,b);return true}else return false};this.hasObserver=function(a){return!(!a||!c[a[0]]||
!c[a[0]][a[1]])}}this.create=function(){return new d}});Emily.declare("Promises",function(){});
Emily.declare("TinyStore",function(d){function c(a){var b={},c=d.require("Tools"),f=d.require("Observable").create();c.mixin(a,b);this.getNbItems=function(){return c.count(b)};this.get=function(a){return b[a]};this.has=function(a){return b.hasOwnProperty(a)};this.set=function(a,c){var e;return typeof a=="string"?(e=b[a],b[a]=c,f.notify(a,c,e),true):false};this.del=function(a){return this.has(a)?(delete b[a],f.notify(a,b[a]),true):false};this.watch=function(a,b,c){return f.watch(a,b,c)};this.unwatch=
function(a){return f.unwatch(a)}}this.create=function(a){return new c(a)}});Emily.declare("Tools",function(){this.getGlobal=function(){return function(){return this}.call(null)};this.mixin=function(d,c,a){for(var b in d)if(d.hasOwnProperty(b)&&(!c[b]||!a))c[b]=d[b]};this.count=function(d){var c=0,a;for(a in d)d.hasOwnProperty(a)&&c++;return c}});
Emily.declare("Transport",function(d){function c(){var a,b=d.require("io");this.connect=function(c){a=b.connect(c);return this};this.getSocket=function(){return a};this.on=function(b,c){a.on(b,c)};this.emit=function(b,c){a.emit(b,c)}}this.create=function(a){return(new c(a)).connect(a)}});
