function Emily(){var d={},b={},a={},c=false;this.declare=function(a,c,f){if(typeof c=="string"&&typeof f=="function")f.prototype=new d[c](this);else if(typeof c=="function")f=c;else return false;f.prototype._declaredName=a;b[a]=new f(this);return d[a]=f};this.require=function(g){return c&&a[g]||b[g]||this.require("Tools").getGlobal()[g]};this.setIsolationMode=function(a){c=a};this.getIsolationMode=function(){return c};this.inject=function(c,b){a[c]=b}}Emily=new Emily;
Emily.declare("Observable",function(){function d(){var b={};this.watch=function(a,c,g){if(typeof a=="string"&&typeof c=="function"){var d=b[a]=b[a]||[];observer=[c,g];d.push(observer);return[a,d.indexOf(observer)]}else return false};this.unwatch=function(a){var c=a[0],a=a[1];return b[c]&&b[c][a]?(b[c][a]=null,true):false};this.notify=function(a,c){var d=b[a],e;if(d){for(e=d.length;e--;)d[e]&&d[e][0].call(d[e][1]||null,c);return true}else return false};this.hasObserver=function(a){return!(!a||!b[a[0]]||
!b[a[0]][a[1]])}}this.create=function(){return new d}});Emily.declare("Promises",function(){});
Emily.declare("TinyStore",function(d){function b(a){var c={},b=d.require("Tools"),e=d.require("Observable").create();b.mixin(a,c);this.getNbItems=function(){return b.count(c)};this.get=function(a){return c[a]};this.has=function(a){return c.hasOwnProperty(a)};this.set=function(a,b){var d;return typeof a=="string"?(d=c[a],c[a]=b,e.notify(a,b,d),true):false};this.del=function(a){return this.has(a)?(delete c[a],e.notify(a,c[a]),true):false};this.watch=function(a,b,d){b=e.watch(a,b,d);c[a]&&e.notify(a,
c[a]);return b};this.unwatch=function(a){return e.unwatch(a)}}this.create=function(a){return new b(a)}});Emily.declare("Tools",function(){this.getGlobal=function(){return function(){return this}.call(null)};this.mixin=function(d,b,a){for(var c in d)if(d.hasOwnProperty(c)&&(!b[c]||!a))b[c]=d[c]};this.count=function(d){var b=0,a;for(a in d)d.hasOwnProperty(a)&&b++;return b};this.compareObjects=function(d,b){return Object.getOwnPropertyNames(d).sort().join("")==Object.getOwnPropertyNames(b).sort().join("")}});
Emily.declare("Transport",function(d){function b(){var a,c=d.require("io");this.connect=function(b){a=c.connect(b);return this};this.getSocket=function(){return a};this.on=function(b,c){a.on(b,c)};this.emit=function(b,c){a.emit(b,c)}}this.create=function(a){return(new b(a)).connect(a)}});
