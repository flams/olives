/*
 Olives <VERSION> http://flams.github.com/olives
 The MIT License (MIT)
 Copyright (c) 2012-2013 Olivier Scherrer <pode.fr@gmail.com> - Olivier Wietrich <olivier.wietrich@gmail.com>
*/
define("DomUtils",["Tools"],function(i){return{getNodes:function(c,f){return this.isAcceptedType(c)?(c.parentNode||document.createDocumentFragment().appendChild(c),c.parentNode.querySelectorAll(f||"*")):false},getDataset:function(c){var f=0,b,g={},e,a;if(this.isAcceptedType(c))if(c.hasOwnProperty("dataset"))return c.dataset;else{for(b=c.attributes.length;f<b;f++)e=c.attributes[f].name.split("-"),e.shift()=="data"&&(g[a=e.join("-")]=c.getAttribute("data-"+a));return g}else return false},isAcceptedType:function(c){return c instanceof
HTMLElement||c instanceof SVGElement?true:false},setAttribute:function(c,f,b){return c instanceof HTMLElement?(c[f]=b,true):c instanceof SVGElement?(c.setAttribute(f,b),true):false},matches:function(c,f,b){return i.toArray(this.getNodes(c,f)).indexOf(b)>-1}}});
define("Bind.plugin",["Store","Observable","Tools","DomUtils"],function(i,c,f,b){return function(c,e){function a(d){j[d]&&j[d].forEach(function(d){k.unwatchValue(d)});delete j[d]}var k=null,h={},l={},j={};this.observers=j;this.setModel=function(d){return d instanceof i?(k=d,true):false};this.getModel=function(){return k};this.ItemRenderer=function(d,c){var g=null,h=null,e=null,j=null,l=null;this.setRenderer=function(d){g=d;return true};this.getRenderer=function(){return g};this.setRootNode=function(d){return b.isAcceptedType(d)?
(e=d,d=e.querySelector("*"),this.setRenderer(d),d&&e.removeChild(d),true):false};this.getRootNode=function(){return e};this.setPlugins=function(d){h=d;return true};this.getPlugins=function(){return h};this.items=new i([]);this.setStart=function(d){return j=parseInt(d,10)};this.getStart=function(){return j};this.setNb=function(d){return l=d=="*"?d:parseInt(d,10)};this.getNb=function(){return l};this.addItem=function(d){var a;return typeof d=="number"&&!this.items.get(d)?(a=this.create(d))?((d=this.getNextItem(d))?
e.insertBefore(a,d):e.appendChild(a),true):false:false};this.getNextItem=function(d){return this.items.proxy("slice",d+1).filter(function(d){if(b.isAcceptedType(d))return true})[0]};this.removeItem=function(d){var b=this.items.get(d);return b?(e.removeChild(b),this.items.set(d),a(d),true):false};this.create=function(d){if(k.has(d)){var a=g.cloneNode(true),c=b.getNodes(a);f.toArray(c).forEach(function(a){a.setAttribute("data-"+h.name+"_id",d)});this.items.set(d,a);h.apply(a);return a}};this.render=
function(){var d=l=="*"?k.getNbItems():l,a=[];if(l!==null&&j!==null){this.items.loop(function(b,c){(c<j||c>=j+d||!k.has(c))&&a.push(c)},this);a.sort(f.compareNumbers).reverse().forEach(this.removeItem,this);for(var b=j,c=d+j;b<c;b++)this.addItem(b);return true}else return false};this.setPlugins(d);this.setRootNode(c)};this.setItemRenderer=function(d,a){l[d||"default"]=a};this.getItemRenderer=function(d){return l[d]};this.foreach=function(d,b,c,f){var e=new this.ItemRenderer(this.plugins,d);e.setStart(c||
0);e.setNb(f||"*");e.render();k.watch("added",e.render,e);k.watch("deleted",function(d){e.render();a(d)},this);this.setItemRenderer(b,e)};this.updateStart=function(d,a){var b=this.getItemRenderer(d);return b?(b.setStart(a),true):false};this.updateNb=function(d,a){var b=this.getItemRenderer(d);return b?(b.setNb(a),true):false};this.refresh=function(d){return(d=this.getItemRenderer(d))?(d.render(),true):false};this.bind=function(d,a,c){var c=c||"",e=d.getAttribute("data-"+this.plugins.name+"_id"),g=
c.split("."),h=e||g.shift(),j=e?c:g.join("."),e=f.getNestedProperty(k.get(h),j),l=f.toArray(arguments).slice(3);if(e||e===0||e===false)this.execBinding.apply(this,[d,a,e].concat(l))||b.setAttribute(d,a,e);this.hasBinding(a)||d.addEventListener("change",function(){k.has(h)&&(j?k.update(h,c,d[a]):k.set(h,d[a]))},true);this.observers[h]=this.observers[h]||[];this.observers[h].push(k.watchValue(h,function(c){this.execBinding.apply(this,[d,a,f.getNestedProperty(c,j)].concat(l))||b.setAttribute(d,a,f.getNestedProperty(c,
j))},this))};this.set=function(d){return b.isAcceptedType(d)&&d.name?(k.set(d.name,d.value),true):false};this.getItemIndex=function(d){return(d=b.getDataset(d))&&typeof d[this.plugins.name+"_id"]!="undefined"?+d[this.plugins.name+"_id"]:false};this.form=function m(m){if(m&&m.nodeName=="FORM"){var a=this;m.addEventListener("submit",function(b){f.toArray(m.querySelectorAll("[name]")).forEach(a.set,a);b.preventDefault()},true);return true}else return false};this.addBinding=function(a,b){return a&&typeof a==
"string"&&typeof b=="function"?(h[a]=b,true):false};this.execBinding=function(a,b){return this.hasBinding(b)?(h[b].apply(a,Array.prototype.slice.call(arguments,2)),true):false};this.hasBinding=function(a){return h.hasOwnProperty(a)};this.getBinding=function(a){return h[a]};this.addBindings=function(a){return f.loop(a,function(a,b){this.addBinding(b,a)},this)};this.setModel(c);this.addBindings(e)}});
define("Event.plugin",["DomUtils"],function(i){return function(c,f){var b=null,g={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},e=!!f;this.addEventListener=function(a,b,c,e){a.addEventListener(this.map(b),c,!!e)};this.listen=function(a,c,e,f){this.addEventListener(a,c,function(c){b[e].call(b,c,a)},!!f)};this.delegate=function(a,c,e,f,g){this.addEventListener(a,e,function(d){i.matches(a,c,d.target)&&b[f].call(b,d,a)},!!g)};this.getParent=function(){return b};this.setParent=function(a){return a instanceof
Object?(b=a,true):false};this.map=function(a){return e?g[a]||a:a};this.setMap=function(a,b){return typeof a=="string"&&typeof b=="string"?(g[a]=b,true):false};this.setParent(c)}});
define("LocalStore",["Store","Tools"],function(i,c){function f(){var b=null,f=localStorage,e=function(){f.setItem(b,this.toJSON())};this.setLocalStorage=function(a){return a&&a.setItem instanceof Function?(f=a,true):false};this.getLocalStorage=function(){return f};this.sync=function(a){return typeof a=="string"?(b=a,a=JSON.parse(f.getItem(a)),c.loop(a,function(a,b){this.has(b)||this.set(b,a)},this),e.call(this),this.watch("added",e,this),this.watch("updated",e,this),this.watch("deleted",e,this),true):
false}}return function(b){f.prototype=new i(b);return new f}});
define("Plugins",["Tools","DomUtils"],function(i,c){return function(f){var b={},g=function(a){return a.trim()},e=function(a,c,e){c.split(";").forEach(function(c){var f=c.split(":"),c=f[0].trim(),f=f[1]?f[1].split(",").map(g):[];f.unshift(a);b[e]&&b[e][c]&&b[e][c].apply(b[e],f)})};this.add=function(a,c){var e=this;return typeof a=="string"&&typeof c=="object"&&c?(b[a]=c,c.plugins={name:a,apply:function(){return e.apply.apply(e,arguments)}},true):false};this.addAll=function(a){return i.loop(a,function(a,
b){this.add(b,a)},this)};this.get=function(a){return b[a]};this.del=function(a){return delete b[a]};this.apply=function(a){var b;return c.isAcceptedType(a)?(b=c.getNodes(a),i.loop(i.toArray(b),function(a){i.loop(c.getDataset(a),function(b,c){e(a,b,c)})}),a):false};this.addAll(f)}});
define("OObject",["StateMachine","Store","Plugins","DomUtils","Tools"],function(i,c,f,b,g){return function(e){var a=function(a){var d=h||document.createElement("div");if(a.template){typeof a.template=="string"?d.innerHTML=a.template.trim():b.isAcceptedType(a.template)&&d.appendChild(a.template);if(d.childNodes.length>1)throw Error("UI.template should have only one parent node");else a.dom=d.childNodes[0];a.plugins.apply(a.dom)}else throw Error("UI.template must be set prior to render");},k=function d(a,
d,b){d&&(b?d.insertBefore(a.dom,b):d.appendChild(a.dom),h=d)},h=null,l=new i("Init",{Init:[["render",a,this,"Rendered"],["place",function(d,b){a(d);k.apply(null,g.toArray(arguments))},this,"Rendered"]],Rendered:[["place",k,this],["render",a,this]]});this.model=e instanceof c?e:new c;this.plugins=new f;this.dom=this.template=null;this.place=function(a,b){l.event("place",this,a,b)};this.render=function(){l.event("render",this)};this.setTemplateFromDom=function(a){return b.isAcceptedType(a)?(this.template=
a,true):false};this.alive=function(a){return b.isAcceptedType(a)?(this.setTemplateFromDom(a),this.place(a.parentNode,a.nextElementSibling),true):false};this.getCurrentPlace=function(){return h}}});
define("Place.plugin",["OObject","Tools"],function(i,c){return function(f){var b={};this.place=function(c,e){if(b[e]instanceof i)b[e].place(c);else throw Error(e+" is not an OObject UI in place:"+e);};this.set=function(c,e){return typeof c=="string"&&e instanceof i?(b[c]=e,true):false};this.setAll=function(b){c.loop(b,function(b,a){this.set(a,b)},this)};this.get=function(c){return b[c]};this.setAll(f)}});
define("SocketIOTransport",["Observable","Tools"],function(){return function(i){var c=null;this.setSocket=function(f){return f&&typeof f.emit=="function"?(c=f,true):false};this.getSocket=function(){return c};this.on=function(f,b){return c.on(f,b)};this.once=function(f,b){return c.once(f,b)};this.emit=function(f,b,g){return c.emit(f,b,g)};this.removeListener=function(f,b,g){return c.removeListener(f,b,g)};this.request=function(c,b,g,e){return typeof c=="string"&&typeof b!="undefined"?(b={eventId:Date.now()+
Math.floor(Math.random()*1E6),data:b},this.once(b.eventId,function(){g&&g.apply(e||null,arguments)}),this.emit(c,b),true):false};this.listen=function(c,b,g,e){if(typeof c=="string"&&typeof b!="undefined"&&typeof g=="function"){var a={eventId:Date.now()+Math.floor(Math.random()*1E6),data:b,keepAlive:true},i=function(){g&&g.apply(e||null,arguments)},h=this;this.on(a.eventId,i);this.emit(c,a);return function(){h.emit("disconnect-"+a.eventId);h.removeListener(a.eventId,i)}}else return false};this.setSocket(i)}});
