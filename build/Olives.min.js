/*
 Olives <VERSION> http://flams.github.com/olives
 The MIT License (MIT)
 Copyright (c) 2012-2013 Olivier Scherrer <pode.fr@gmail.com> - Olivier Wietrich <olivier.wietrich@gmail.com>
*/
define("DomUtils",["Tools"],function(g){return{getNodes:function(c,e){return this.isAcceptedType(c)?(c.parentNode||document.createDocumentFragment().appendChild(c),c.parentNode.querySelectorAll(e||"*")):false},getDataset:function(c){var e=0,b,a={},d,f;if(this.isAcceptedType(c))if(c.hasOwnProperty("dataset"))return c.dataset;else{for(b=c.attributes.length;e<b;e++)d=c.attributes[e].name.split("-"),d.shift()=="data"&&(a[f=d.join("-")]=c.getAttribute("data-"+f));return a}else return false},isAcceptedType:function(c){return c instanceof
HTMLElement||c instanceof SVGElement?true:false},setAttribute:function(c,e,b){return c instanceof HTMLElement?(c[e]=b,true):c instanceof SVGElement?(c.setAttribute(e,b),true):false},matches:function(c,e,b){return g.toArray(this.getNodes(c,e)).indexOf(b)>-1}}});
define("Bind.plugin",["Store","Observable","Tools","DomUtils"],function(g,c,e,b){return function(a,c){function f(a){i[a]&&(i[a].forEach(function(a){j.unwatchValue(a)}),delete i[a])}var j=null,h={},k={},i={};this.observers=i;this.setModel=function(a){return a instanceof g?(j=a,true):false};this.getModel=function(){return j};this.ItemRenderer=function(a,c){var d=null,i=null,h=null,g=null,k=null;this.setRenderer=function(a){d=a;return true};this.getRenderer=function(){return d};this.setRootNode=function(a){return b.isAcceptedType(a)?
(h=a,a=h.querySelector("*"),this.setRenderer(a),a&&h.removeChild(a),true):false};this.getRootNode=function(){return h};this.setPlugins=function(a){i=a;return true};this.getPlugins=function(){return i};this.items={};this.setStart=function(a){return g=parseInt(a,10)};this.getStart=function(){return g};this.setNb=function(a){return k=a=="*"?a:parseInt(a,10)};this.getNb=function(){return k};this.addItem=function(a){var b;return typeof a=="number"&&!this.items[a]?(b=this.getNextItem(a),(a=this.create(a))?
(b?h.insertBefore(a,b):h.appendChild(a),true):false):false};this.getNextItem=function(a){var b=Object.keys(this.items).map(function(a){return Number(a)}),f=e.closestGreater(a,b),b=b[f];if(b!=a)return this.items[b]};this.removeItem=function(a){var b=this.items[a];return b?(h.removeChild(b),delete this.items[a],f(a),true):false};this.create=function(a){if(j.has(a)){var f=d.cloneNode(true),l=b.getNodes(f);e.toArray(l).forEach(function(b){b.setAttribute("data-"+i.name+"_id",a)});this.items[a]=f;i.apply(f);
return f}};this.render=function(){var a=k=="*"?j.getNbItems():k,b=[];if(k!==null&&g!==null){e.loop(this.items,function(f,l){l=Number(l);(l<g||l>=g+a||!j.has(l))&&b.push(l)},this);b.sort(e.compareNumbers).reverse().forEach(this.removeItem,this);for(var f=g,l=a+g;f<l;f++)this.addItem(f);return true}else return false};this.setPlugins(a);this.setRootNode(c)};this.setItemRenderer=function(a,b){k[a||"default"]=b};this.getItemRenderer=function(a){return k[a]};this.foreach=function(a,b,c,e){var d=new this.ItemRenderer(this.plugins,
a);d.setStart(c||0);d.setNb(e||"*");d.render();j.watch("added",d.render,d);j.watch("deleted",function(a){d.render();f(a)},this);this.setItemRenderer(b,d)};this.updateStart=function(a,b){var f=this.getItemRenderer(a);return f?(f.setStart(b),true):false};this.updateNb=function(a,b){var f=this.getItemRenderer(a);return f?(f.setNb(b),true):false};this.refresh=function(a){return(a=this.getItemRenderer(a))?(a.render(),true):false};this.bind=function(a,f,c){var c=c||"",d=a.getAttribute("data-"+this.plugins.name+
"_id"),i=c.split("."),h=d||i.shift(),g=d?c:i.join("."),d=e.getNestedProperty(j.get(h),g),k=e.toArray(arguments).slice(3);if(d||d===0||d===false)this.execBinding.apply(this,[a,f,d].concat(k))||b.setAttribute(a,f,d);this.hasBinding(f)||a.addEventListener("change",function(){j.has(h)&&(g?j.update(h,c,a[f]):j.set(h,a[f]))},true);this.observers[h]=this.observers[h]||[];this.observers[h].push(j.watchValue(h,function(c){this.execBinding.apply(this,[a,f,e.getNestedProperty(c,g)].concat(k))||b.setAttribute(a,
f,e.getNestedProperty(c,g))},this))};this.set=function(a){return b.isAcceptedType(a)&&a.name?(j.set(a.name,a.value),true):false};this.getItemIndex=function(a){return(a=b.getDataset(a))&&typeof a[this.plugins.name+"_id"]!="undefined"?+a[this.plugins.name+"_id"]:false};this.form=function(a){if(a&&a.nodeName=="FORM"){var b=this;a.addEventListener("submit",function(f){e.toArray(a.querySelectorAll("[name]")).forEach(b.set,b);f.preventDefault()},true);return true}else return false};this.addBinding=function(a,
b){return a&&typeof a=="string"&&typeof b=="function"?(h[a]=b,true):false};this.execBinding=function(a,b){return this.hasBinding(b)?(h[b].apply(a,Array.prototype.slice.call(arguments,2)),true):false};this.hasBinding=function(a){return h.hasOwnProperty(a)};this.getBinding=function(a){return h[a]};this.addBindings=function(a){return e.loop(a,function(a,b){this.addBinding(b,a)},this)};this.setModel(a);this.addBindings(c)}});
define("Event.plugin",["DomUtils"],function(g){return function(c,e){var b=null,a={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},d=!!e;this.addEventListener=function(a,b,c,d){a.addEventListener(this.map(b),c,!!d)};this.listen=function(a,c,d,e){this.addEventListener(a,c,function(c){b[d].call(b,c,a)},!!e)};this.delegate=function(a,c,d,e,i){this.addEventListener(a,d,function(d){g.matches(a,c,d.target)&&b[e].call(b,d,a)},!!i)};this.getParent=function(){return b};this.setParent=function(a){return a instanceof
Object?(b=a,true):false};this.map=function(b){return d?a[b]||b:b};this.setMap=function(b,c){return typeof b=="string"&&typeof c=="string"?(a[b]=c,true):false};this.setParent(c)}});
define("LocalStore",["Store","Tools"],function(g,c){function e(){var b=null,a=localStorage,d=function(){a.setItem(b,this.toJSON())};this.setLocalStorage=function(b){return b&&b.setItem instanceof Function?(a=b,true):false};this.getLocalStorage=function(){return a};this.sync=function(f){return typeof f=="string"?(b=f,f=JSON.parse(a.getItem(f)),c.loop(f,function(a,b){this.has(b)||this.set(b,a)},this),d.call(this),this.watch("added",d,this),this.watch("updated",d,this),this.watch("deleted",d,this),true):
false}}return function(b){e.prototype=new g(b);return new e}});
define("Plugins",["Tools","DomUtils"],function(g,c){return function(e){var b={},a=function(a){return a.trim()},d=function(c,d,e){d.split(";").forEach(function(d){var i=d.split(":"),d=i[0].trim(),i=i[1]?i[1].split(",").map(a):[];i.unshift(c);b[e]&&b[e][d]&&b[e][d].apply(b[e],i)})};this.add=function(a,c){var d=this;return typeof a=="string"&&typeof c=="object"&&c?(b[a]=c,c.plugins={name:a,apply:function(){return d.apply.apply(d,arguments)}},true):false};this.addAll=function(a){return g.loop(a,function(a,
b){this.add(b,a)},this)};this.get=function(a){return b[a]};this.del=function(a){return delete b[a]};this.apply=function(a){var b;return c.isAcceptedType(a)?(b=c.getNodes(a),g.loop(g.toArray(b),function(a){g.loop(c.getDataset(a),function(b,c){d(a,b,c)})}),a):false};this.addAll(e)}});
define("OObject",["StateMachine","Store","Plugins","DomUtils","Tools"],function(g,c,e,b,a){return function(d){var f=function(a){var c=h||document.createElement("div");if(a.template){typeof a.template=="string"?c.innerHTML=a.template.trim():b.isAcceptedType(a.template)&&c.appendChild(a.template);if(c.childNodes.length>1)throw Error("UI.template should have only one parent node");else a.dom=c.childNodes[0];a.plugins.apply(a.dom)}else throw Error("UI.template must be set prior to render");},j=function(a,
b,c){b&&(c?b.insertBefore(a.dom,c):b.appendChild(a.dom),h=b)},h=null,k=new g("Init",{Init:[["render",f,this,"Rendered"],["place",function(b,c){f(b);j.apply(null,a.toArray(arguments))},this,"Rendered"]],Rendered:[["place",j,this],["render",f,this]]});this.model=d instanceof c?d:new c;this.plugins=new e;this.dom=this.template=null;this.place=function(a,b){k.event("place",this,a,b)};this.render=function(){k.event("render",this)};this.setTemplateFromDom=function(a){return b.isAcceptedType(a)?(this.template=
a,true):false};this.alive=function(a){return b.isAcceptedType(a)?(this.setTemplateFromDom(a),this.place(a.parentNode,a.nextElementSibling),true):false};this.getCurrentPlace=function(){return h}}});
define("Place.plugin",["OObject","Tools"],function(g,c){return function(e){var b={};this.place=function(a,c){if(b[c]instanceof g)b[c].place(a);else throw Error(c+" is not an OObject UI in place:"+c);};this.set=function(a,c){return typeof a=="string"&&c instanceof g?(b[a]=c,true):false};this.setAll=function(a){c.loop(a,function(a,b){this.set(b,a)},this)};this.get=function(a){return b[a]};this.setAll(e)}});
define("SocketIOTransport",["Observable","Tools"],function(){return function(g){var c=null;this.setSocket=function(e){return e&&typeof e.emit=="function"?(c=e,true):false};this.getSocket=function(){return c};this.on=function(e,b){return c.on(e,b)};this.once=function(e,b){return c.once(e,b)};this.emit=function(e,b,a){return c.emit(e,b,a)};this.removeListener=function(e,b,a){return c.removeListener(e,b,a)};this.request=function(c,b,a,d){return typeof c=="string"&&typeof b!="undefined"?(b={eventId:Date.now()+
Math.floor(Math.random()*1E6),data:b},this.once(b.eventId,function(){a&&a.apply(d||null,arguments)}),this.emit(c,b),true):false};this.listen=function(c,b,a,d){if(typeof c=="string"&&typeof b!="undefined"&&typeof a=="function"){var f={eventId:Date.now()+Math.floor(Math.random()*1E6),data:b,keepAlive:true},g=function(){a&&a.apply(d||null,arguments)},h=this;this.on(f.eventId,g);this.emit(c,f);return function(){h.emit("disconnect-"+f.eventId);h.removeListener(f.eventId,g)}}else return false};this.setSocket(g)}});
define("Stack",[],function(){return function(g){var c=document.createDocumentFragment(),e=document.createDocumentFragment(),b=[];this.add=function(a){return!this.has(a)&&a instanceof HTMLElement?(c.appendChild(a),b.push(a),a):false};this.remove=function(a){var d;return this.has(a)?(d=b.indexOf(a),c.removeChild(a),b.splice(d,1),a):false};this.place=function(a){return a instanceof HTMLElement?([].slice.call(c.childNodes).forEach(function(b){this.has(b)&&a.appendChild(b)},this),this._setParent(a)):false};
this.up=function(a){if(this.has(a)){var b=this.getPosition(a);this.move(a,b+2);return a}else return false};this.down=function(a){if(this.has(a)){var b=this.getPosition(a);this.move(a,b-1);return a}else return false};this.move=function(a,d){if(this.has(a)){var e=b.indexOf(a);b.splice(e,1);b.splice(d,0,a);(e=b[d+1])?c.insertBefore(a,e):c.appendChild(a);return a}else return false};this.insert=function(a,d){return!this.has(a)&&a instanceof HTMLElement?(b.splice(d,0,a),c.insertBefore(a,c.childNodes[d]),
a):false};this.getPosition=function(a){return b.indexOf(a)};this.count=function(){return c.childNodes.length};this.has=function(a){return this.getPosition(a)>=0};this.hide=function(a){return this.has(a)?(e.appendChild(a),true):false};this.show=function(a){return this.has(a)&&a.parentNode===e?(this.move(a,b.indexOf(a)),true):false};this.hideAll=function(){b.forEach(this.hide,this)};this.showAll=function(){b.forEach(this.show,this)};this.getParent=function(){return c};this._setParent=function(a){return a instanceof
HTMLElement?c=a:false};this.getHidePlace=function(){return e};this.setHidePlace=function(a){return a instanceof HTMLElement?(e=a,true):false};this._setParent(g)}});
define("LocationRouter",["Router","Tools"],function(g,c){function e(){var b;this.parse=function(a){return a.split("#").pop().split("/")};this.toUrl=function(a){return a.join("/")};this.start=function(){this.navigate.apply(this,this.parse(window.location.hash));this.bindOnHashChange();this.bindOnRouteChange()};this.destroy=function(){this.unwatch(b);window.removeEventListener("hashchange",this.boundOnHashChange,true)};this.onHashChange=function(a){this.navigate.apply(this,this.parse(a.newUrl.split("#").pop()))};
this.boundOnHashChange=this.onHashChange.bind(this);this.bindOnHashChange=function(){window.addEventListener("hashchange",this.boundOnHashChange,true)};this.bindOnRouteChange=function(){b=this.watch("route",this.onRouteChange,this)};this.onRouteChange=function(){window.location.hash=this.toUrl(c.toArray(arguments))}}return function(){e.prototype=new g;return new e}});
