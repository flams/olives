/*
 Olives <VERSION> http://flams.github.com/olives
 The MIT License (MIT)
 Copyright (c) 2012 Olivier Scherrer <pode.fr@gmail.com> - Olivier Wietrich <olivier.wietrich@gmail.com>
*/
define("DomUtils",["Tools"],function(i){return{getNodes:function(c,d){return this.isAcceptedType(c)?(c.parentNode||document.createDocumentFragment().appendChild(c),c.parentNode.querySelectorAll(d||"*")):false},getDataset:function(c){var d=0,e,f={},b,a;if(this.isAcceptedType(c))if(c.hasOwnProperty("dataset"))return c.dataset;else{for(e=c.attributes.length;d<e;d++)b=c.attributes[d].name.split("-"),b.shift()=="data"&&(f[a=b.join("-")]=c.getAttribute("data-"+a));return f}else return false},isAcceptedType:function(c){return c instanceof
HTMLElement||c instanceof SVGElement?true:false},setAttribute:function(c,d,e){return c instanceof HTMLElement?(c[d]=e,true):c instanceof SVGElement?(c.setAttribute(d,e),true):false},matches:function(c,d,e){return i.toArray(this.getNodes(e,d)).indexOf(c)>-1}}});
define("Bind.plugin",["Store","Observable","Tools","DomUtils"],function(i,c,d,e){return function(c,b){var a=null,h={},j={};this.observers={};this.setModel=function(b){return b instanceof i?(a=b,true):false};this.getModel=function(){return a};this.ItemRenderer=function(b,k){var g=null,h=null,c=null,f=null,j=null;this.setRenderer=function(a){g=a;return true};this.getRenderer=function(){return g};this.setRootNode=function(a){return e.isAcceptedType(a)?(c=a,a=c.querySelector("*"),this.setRenderer(a),
a&&c.removeChild(a),true):false};this.getRootNode=function(){return c};this.setPlugins=function(a){h=a;return true};this.getPlugins=function(){return h};this.items=new i([]);this.setStart=function(a){return f=parseInt(a,10)};this.getStart=function(){return f};this.setNb=function(a){return j=a=="*"?a:parseInt(a,10)};this.getNb=function(){return j};this.addItem=function(a){var b;return typeof a=="number"&&!this.items.get(a)?(b=this.create(a))?((a=this.getNextItem(a))?c.insertBefore(b,a):c.appendChild(b),
true):false:false};this.getNextItem=function(a){return this.items.alter("slice",a+1).filter(function(a){if(e.isAcceptedType(a))return true})[0]};this.removeItem=function(a){var b=this.items.get(a);return b?(c.removeChild(b),this.items.set(a),true):false};this.create=function(b){if(a.has(b)){var k=g.cloneNode(true),l=e.getNodes(k);d.toArray(l).forEach(function(a){a.setAttribute("data-"+h.name+"_id",b)});this.items.set(b,k);h.apply(k);return k}};this.render=function(){var b=j=="*"?a.getNbItems():j,
g=[];if(j!==null&&f!==null){this.items.loop(function(k,l){(l<f||l>=f+b||!a.has(l))&&g.push(l)},this);g.sort(d.compareNumbers).reverse().forEach(this.removeItem,this);for(var k=f,l=b+f;k<l;k++)this.addItem(k);return true}else return false};this.setPlugins(b);this.setRootNode(k)};this.setItemRenderer=function(a,b){j[a||"default"]=b};this.getItemRenderer=function(a){return j[a]};this.foreach=function(b,k,g,c){var h=new this.ItemRenderer(this.plugins,b);h.setStart(g||0);h.setNb(c||"*");h.render();a.watch("added",
h.render,h);a.watch("deleted",function(b){h.render();this.observers[b]&&this.observers[b].forEach(function(b){a.unwatchValue(b)},this);delete this.observers[b]},this);this.setItemRenderer(k,h)};this.updateStart=function(a,b){var g=this.getItemRenderer(a);return g?(g.setStart(b),true):false};this.updateNb=function(a,b){var g=this.getItemRenderer(a);return g?(g.setNb(b),true):false};this.refresh=function(a){return(a=this.getItemRenderer(a))?(a.render(),true):false};this.bind=function(b,h,g){var g=g||
"",c=b.getAttribute("data-"+this.plugins.name+"_id"),f=g.split("."),j=c||f.shift(),i=c?g:f.join("."),c=d.getNestedProperty(a.get(j),i),m=d.toArray(arguments).slice(3);if(c||c===0||c===false)this.execBinding.apply(this,[b,h,c].concat(m))||e.setAttribute(b,h,c);this.hasBinding(h)||b.addEventListener("change",function(){a.has(j)&&(i?a.update(j,g,b[h]):a.set(j,b[h]))},true);this.observers[j]=this.observers[j]||[];this.observers[j].push(a.watchValue(j,function(a){this.execBinding.apply(this,[b,h,d.getNestedProperty(a,
i)].concat(m))||e.setAttribute(b,h,d.getNestedProperty(a,i))},this))};this.set=function(b){return e.isAcceptedType(b)&&b.name?(a.set(b.name,b.value),true):false};this.form=function k(k){if(k&&k.nodeName=="FORM"){var a=this;k.addEventListener("submit",function(b){d.toArray(k.querySelectorAll("[name]")).forEach(a.set,a);b.preventDefault()},true);return true}else return false};this.addBinding=function(a,b){return a&&typeof a=="string"&&typeof b=="function"?(h[a]=b,true):false};this.execBinding=function(a,
b){return this.hasBinding(b)?(h[b].apply(a,Array.prototype.slice.call(arguments,2)),true):false};this.hasBinding=function(a){return h.hasOwnProperty(a)};this.getBinding=function(a){return h[a]};this.addBindings=function(a){return d.loop(a,function(a,b){this.addBinding(b,a)},this)};this.setModel(c);this.addBindings(b)}});
define("Event.plugin",["DomUtils"],function(i){return function(c,d){var e=null,f={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},b=!!d;this.addEventListener=function(a,b,c,e){a.addEventListener(this.map(b),c,!!e)};this.listen=function(a,b,c,d){this.addEventListener(a,b,function(b){e[c].call(e,b,a)},!!d)};this.delegate=function(a,b,c,d,f){this.addEventListener(a,c,function(c){i.matches(a,b,c.target)&&e[d].call(e,c,a)},!!f)};this.getParent=function(){return e};this.setParent=function(a){return a instanceof
Object?(e=a,true):false};this.map=function(a){return b?f[a]||a:a};this.setMap=function(a,b){return typeof a=="string"&&typeof b=="string"?(f[a]=b,true):false};this.setParent(c)}});
define("LocalStore",["Store","Tools"],function(i,c){function d(){var e=null,d=localStorage,b=function(){d.setItem(e,this.toJSON())};this.setLocalStorage=function(a){return a&&a.setItem instanceof Function?(d=a,true):false};this.getLocalStorage=function(){return d};this.sync=function(a){return typeof a=="string"?(e=a,a=JSON.parse(d.getItem(a)),c.loop(a,function(a,b){this.has(b)||this.set(b,a)},this),b.call(this),this.watch("added",b,this),this.watch("updated",b,this),this.watch("deleted",b,this),true):
false}}return function(c){d.prototype=new i(c);return new d}});
define("Plugins",["Tools","DomUtils"],function(i,c){return function(){var d={},e=function(b){return b.trim()},f=function(b,a,c){a.split(";").forEach(function(a){var f=a.split(":"),a=f[0].trim(),f=f[1]?f[1].split(",").map(e):[];f.unshift(b);d[c]&&d[c][a]&&d[c][a].apply(d[c],f)})};this.add=function(b,a){var c=this;return typeof b=="string"&&typeof a=="object"&&a?(d[b]=a,a.plugins={name:b,apply:function(){return c.apply.apply(c,arguments)}},true):false};this.addAll=function(b){return i.loop(b,function(a,
b){this.add(b,a)},this)};this.get=function(b){return d[b]};this.del=function(b){return delete d[b]};this.apply=function(b){var a;return c.isAcceptedType(b)?(a=c.getNodes(b),i.loop(i.toArray(a),function(a){i.loop(c.getDataset(a),function(b,c){f(a,b,c)})}),b):false}}});
define("OObject",["StateMachine","Store","Plugins","DomUtils","Tools"],function(i,c,d,e,f){return function(b){var a=function(a){var b=j||document.createElement("div");if(a.template){typeof a.template=="string"?b.innerHTML=a.template.trim():e.isAcceptedType(a.template)&&b.appendChild(a.template);if(b.childNodes.length>1)throw Error("UI.template should have only one parent node");else a.dom=b.childNodes[0];a.plugins.apply(a.dom)}else throw Error("UI.template must be set prior to render");},h=function g(a,
g,b){g&&(b?g.insertBefore(a.dom,b):g.appendChild(a.dom),j=g)},j=null,l=new i("Init",{Init:[["render",a,this,"Rendered"],["place",function(b,c){a(b);h.apply(null,f.toArray(arguments))},this,"Rendered"]],Rendered:[["place",h,this],["render",a,this]]});this.model=b instanceof c?b:new c;this.plugins=new d;this.dom=this.template=null;this.place=function(a,b){l.event("place",this,a,b)};this.render=function(){l.event("render",this)};this.setTemplateFromDom=function(a){return e.isAcceptedType(a)?(this.template=
a,true):false};this.alive=function(a){return e.isAcceptedType(a)?(this.setTemplateFromDom(a),this.place(a.parentNode,a.nextElementSibling),true):false};this.getCurrentPlace=function(){return j}}});
define("Place.plugin",["OObject","Tools"],function(i,c){return function(d){var e={};this.place=function(c,b){if(e[b]instanceof i)e[b].place(c);else throw Error(b+" is not an OObject UI in place:"+b);};this.set=function(c,b){return typeof c=="string"&&b instanceof i?(e[c]=b,true):false};this.setAll=function(d){c.loop(d,function(b,a){this.set(a,b)},this)};this.get=function(c){return e[c]};this.setAll(d)}});
define("SocketIOTransport",["Observable","Tools"],function(i){return function(c,d){var e=null,f=null;new i;this.setIO=function(b){return b&&typeof b.connect=="function"?(f=b,true):false};this.getIO=function(){return f};this.connect=function(b){return typeof b=="string"?(e=f.connect(b),true):false};this.getSocket=function(){return e};this.on=function(b,a){return e.on(b,a)};this.once=function(b,a){return e.once(b,a)};this.emit=function(b,a,c){return e.emit(b,a,c)};this.removeListener=function(b,a,c){return e.removeListener(b,
a,c)};this.request=function(b,a,c,d){return typeof b=="string"&&typeof a!="undefined"?(a={eventId:Date.now()+Math.floor(Math.random()*1E6),data:a},this.once(a.eventId,function(){c&&c.apply(d||null,arguments)}),this.emit(b,a),true):false};this.listen=function(b,a,c,d){if(typeof b=="string"&&typeof a!="undefined"&&typeof c=="function"){var e={eventId:Date.now()+Math.floor(Math.random()*1E6),data:a,keepAlive:true},f=function(){c&&c.apply(d||null,arguments)},g=this;this.on(e.eventId,f);this.emit(b,e);
return function(){g.emit("disconnect-"+e.eventId);g.removeListener(e.eventId,f)}}else return false};this.setIO(c);this.connect(d)}});
