/*
 Olives <VERSION> http://flams.github.com/olives
 The MIT License (MIT)
 Copyright (c) 2012-2013 Olivier Scherrer <pode.fr@gmail.com> - Olivier Wietrich <olivier.wietrich@gmail.com>
*/
define("DomUtils",["Tools"],function(g){return{getNodes:function(d,e){return this.isAcceptedType(d)?(d.parentNode||document.createDocumentFragment().appendChild(d),d.parentNode.querySelectorAll(e||"*")):false},getDataset:function(d){var e=0,b,i={},f,a;if(this.isAcceptedType(d))if(d.hasOwnProperty("dataset"))return d.dataset;else{for(b=d.attributes.length;e<b;e++)f=d.attributes[e].name.split("-"),f.shift()=="data"&&(i[a=f.join("-")]=d.getAttribute("data-"+a));return i}else return false},isAcceptedType:function(d){return d instanceof
HTMLElement||d instanceof SVGElement?true:false},setAttribute:function(d,e,b){return d instanceof HTMLElement?(d[e]=b,true):d instanceof SVGElement?(d.setAttribute(e,b),true):false},matches:function(d,e,b){return g.toArray(this.getNodes(d,e)).indexOf(b)>-1}}});
define("Bind.plugin",["Store","Observable","Tools","DomUtils"],function(g,d,e,b){return function(d,f){function a(c){j[c]&&j[c].forEach(function(c){k.unwatchValue(c)});delete j[c]}var k=null,h={},m={},j={};this.observers=j;this.setModel=function(c){return c instanceof g?(k=c,true):false};this.getModel=function(){return k};this.ItemRenderer=function(c,d){var i=null,h=null,f=null,j=null,g=null;this.setRenderer=function(c){i=c;return true};this.getRenderer=function(){return i};this.setRootNode=function(c){return b.isAcceptedType(c)?
(f=c,c=f.querySelector("*"),this.setRenderer(c),c&&f.removeChild(c),true):false};this.getRootNode=function(){return f};this.setPlugins=function(c){h=c;return true};this.getPlugins=function(){return h};this.items={};this.setStart=function(c){return j=parseInt(c,10)};this.getStart=function(){return j};this.setNb=function(c){return g=c=="*"?c:parseInt(c,10)};this.getNb=function(){return g};this.addItem=function(c){var a;return typeof c=="number"&&!this.items[c]?(a=this.getClosestItem(c),(c=this.create(c))?
(a?f.insertBefore(c,a):f.appendChild(c),true):false):false};this.getClosestItem=function(c){var a=Object.keys(this.items).sort(e.compareNumbers),b,d;e.loop(a,function(a){var e=a-c;if(e>0&&(!d||e<d))d=e,b=a});return this.items[b]};this.removeItem=function(c){var b=this.items[c];return b?(f.removeChild(b),delete this.items[c],a(c),true):false};this.create=function(c){if(k.has(c)){var a=i.cloneNode(true),d=b.getNodes(a);e.toArray(d).forEach(function(a){a.setAttribute("data-"+h.name+"_id",c)});this.items[c]=
a;h.apply(a);return a}};this.render=function(){var c=g=="*"?k.getNbItems():g,a=[];if(g!==null&&j!==null){e.loop(this.items,function(b,e){e=Number(e);(e<j||e>=j+c||!k.has(e))&&a.push(e)},this);a.sort(e.compareNumbers).reverse().forEach(this.removeItem,this);for(var b=j,d=c+j;b<d;b++)this.addItem(b);return true}else return false};this.setPlugins(c);this.setRootNode(d)};this.setItemRenderer=function(c,a){m[c||"default"]=a};this.getItemRenderer=function(c){return m[c]};this.foreach=function(c,b,e,d){var f=
new this.ItemRenderer(this.plugins,c);f.setStart(e||0);f.setNb(d||"*");f.render();k.watch("added",f.render,f);k.watch("deleted",function(c){f.render();a(c)},this);this.setItemRenderer(b,f)};this.updateStart=function(c,a){var b=this.getItemRenderer(c);return b?(b.setStart(a),true):false};this.updateNb=function(c,a){var b=this.getItemRenderer(c);return b?(b.setNb(a),true):false};this.refresh=function(c){return(c=this.getItemRenderer(c))?(c.render(),true):false};this.bind=function(c,a,d){var d=d||"",
f=c.getAttribute("data-"+this.plugins.name+"_id"),i=d.split("."),h=f||i.shift(),j=f?d:i.join("."),f=e.getNestedProperty(k.get(h),j),g=e.toArray(arguments).slice(3);if(f||f===0||f===false)this.execBinding.apply(this,[c,a,f].concat(g))||b.setAttribute(c,a,f);this.hasBinding(a)||c.addEventListener("change",function(){k.has(h)&&(j?k.update(h,d,c[a]):k.set(h,c[a]))},true);this.observers[h]=this.observers[h]||[];this.observers[h].push(k.watchValue(h,function(d){this.execBinding.apply(this,[c,a,e.getNestedProperty(d,
j)].concat(g))||b.setAttribute(c,a,e.getNestedProperty(d,j))},this))};this.set=function(c){return b.isAcceptedType(c)&&c.name?(k.set(c.name,c.value),true):false};this.getItemIndex=function(c){return(c=b.getDataset(c))&&typeof c[this.plugins.name+"_id"]!="undefined"?+c[this.plugins.name+"_id"]:false};this.form=function l(l){if(l&&l.nodeName=="FORM"){var a=this;l.addEventListener("submit",function(b){e.toArray(l.querySelectorAll("[name]")).forEach(a.set,a);b.preventDefault()},true);return true}else return false};
this.addBinding=function(a,b){return a&&typeof a=="string"&&typeof b=="function"?(h[a]=b,true):false};this.execBinding=function(a,b){return this.hasBinding(b)?(h[b].apply(a,Array.prototype.slice.call(arguments,2)),true):false};this.hasBinding=function(a){return h.hasOwnProperty(a)};this.getBinding=function(a){return h[a]};this.addBindings=function(a){return e.loop(a,function(a,b){this.addBinding(b,a)},this)};this.setModel(d);this.addBindings(f)}});
define("Event.plugin",["DomUtils"],function(g){return function(d,e){var b=null,i={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},f=!!e;this.addEventListener=function(a,b,d,e){a.addEventListener(this.map(b),d,!!e)};this.listen=function(a,d,e,f){this.addEventListener(a,d,function(d){b[e].call(b,d,a)},!!f)};this.delegate=function(a,d,e,f,i){this.addEventListener(a,e,function(c){g.matches(a,d,c.target)&&b[f].call(b,c,a)},!!i)};this.getParent=function(){return b};this.setParent=function(a){return a instanceof
Object?(b=a,true):false};this.map=function(a){return f?i[a]||a:a};this.setMap=function(a,b){return typeof a=="string"&&typeof b=="string"?(i[a]=b,true):false};this.setParent(d)}});
define("LocalStore",["Store","Tools"],function(g,d){function e(){var b=null,e=localStorage,f=function(){e.setItem(b,this.toJSON())};this.setLocalStorage=function(a){return a&&a.setItem instanceof Function?(e=a,true):false};this.getLocalStorage=function(){return e};this.sync=function(a){return typeof a=="string"?(b=a,a=JSON.parse(e.getItem(a)),d.loop(a,function(a,b){this.has(b)||this.set(b,a)},this),f.call(this),this.watch("added",f,this),this.watch("updated",f,this),this.watch("deleted",f,this),true):
false}}return function(b){e.prototype=new g(b);return new e}});
define("Plugins",["Tools","DomUtils"],function(g,d){return function(e){var b={},i=function(a){return a.trim()},f=function(a,e,d){e.split(";").forEach(function(e){var f=e.split(":"),e=f[0].trim(),f=f[1]?f[1].split(",").map(i):[];f.unshift(a);b[d]&&b[d][e]&&b[d][e].apply(b[d],f)})};this.add=function(a,e){var d=this;return typeof a=="string"&&typeof e=="object"&&e?(b[a]=e,e.plugins={name:a,apply:function(){return d.apply.apply(d,arguments)}},true):false};this.addAll=function(a){return g.loop(a,function(a,
b){this.add(b,a)},this)};this.get=function(a){return b[a]};this.del=function(a){return delete b[a]};this.apply=function(a){var b;return d.isAcceptedType(a)?(b=d.getNodes(a),g.loop(g.toArray(b),function(a){g.loop(d.getDataset(a),function(b,e){f(a,b,e)})}),a):false};this.addAll(e)}});
define("OObject",["StateMachine","Store","Plugins","DomUtils","Tools"],function(g,d,e,b,i){return function(f){var a=function(a){var c=h||document.createElement("div");if(a.template){typeof a.template=="string"?c.innerHTML=a.template.trim():b.isAcceptedType(a.template)&&c.appendChild(a.template);if(c.childNodes.length>1)throw Error("UI.template should have only one parent node");else a.dom=c.childNodes[0];a.plugins.apply(a.dom)}else throw Error("UI.template must be set prior to render");},k=function c(a,
c,b){c&&(b?c.insertBefore(a.dom,b):c.appendChild(a.dom),h=c)},h=null,m=new g("Init",{Init:[["render",a,this,"Rendered"],["place",function(c,b){a(c);k.apply(null,i.toArray(arguments))},this,"Rendered"]],Rendered:[["place",k,this],["render",a,this]]});this.model=f instanceof d?f:new d;this.plugins=new e;this.dom=this.template=null;this.place=function(a,b){m.event("place",this,a,b)};this.render=function(){m.event("render",this)};this.setTemplateFromDom=function(a){return b.isAcceptedType(a)?(this.template=
a,true):false};this.alive=function(a){return b.isAcceptedType(a)?(this.setTemplateFromDom(a),this.place(a.parentNode,a.nextElementSibling),true):false};this.getCurrentPlace=function(){return h}}});
define("Place.plugin",["OObject","Tools"],function(g,d){return function(e){var b={};this.place=function(e,d){if(b[d]instanceof g)b[d].place(e);else throw Error(d+" is not an OObject UI in place:"+d);};this.set=function(e,d){return typeof e=="string"&&d instanceof g?(b[e]=d,true):false};this.setAll=function(b){d.loop(b,function(b,a){this.set(a,b)},this)};this.get=function(e){return b[e]};this.setAll(e)}});
define("SocketIOTransport",["Observable","Tools"],function(){return function(g){var d=null;this.setSocket=function(e){return e&&typeof e.emit=="function"?(d=e,true):false};this.getSocket=function(){return d};this.on=function(e,b){return d.on(e,b)};this.once=function(e,b){return d.once(e,b)};this.emit=function(e,b,i){return d.emit(e,b,i)};this.removeListener=function(e,b,i){return d.removeListener(e,b,i)};this.request=function(e,b,d,f){return typeof e=="string"&&typeof b!="undefined"?(b={eventId:Date.now()+
Math.floor(Math.random()*1E6),data:b},this.once(b.eventId,function(){d&&d.apply(f||null,arguments)}),this.emit(e,b),true):false};this.listen=function(e,b,d,f){if(typeof e=="string"&&typeof b!="undefined"&&typeof d=="function"){var a={eventId:Date.now()+Math.floor(Math.random()*1E6),data:b,keepAlive:true},g=function(){d&&d.apply(f||null,arguments)},h=this;this.on(a.eventId,g);this.emit(e,a);return function(){h.emit("disconnect-"+a.eventId);h.removeListener(a.eventId,g)}}else return false};this.setSocket(g)}});
