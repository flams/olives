/*
 Olives <VERSION> http://flams.github.com/olives
 The MIT License (MIT)
 Copyright (c) 2012-2013 Olivier Scherrer <pode.fr@gmail.com> - Olivier Wietrich <olivier.wietrich@gmail.com>
*/
define("DomUtils",["Tools"],function(g){return{getNodes:function(d,c){return this.isAcceptedType(d)?(d.parentNode||document.createDocumentFragment().appendChild(d),d.parentNode.querySelectorAll(c||"*")):false},getDataset:function(d){var c=0,b,e={},f,a;if(this.isAcceptedType(d))if(d.hasOwnProperty("dataset"))return d.dataset;else{for(b=d.attributes.length;c<b;c++)f=d.attributes[c].name.split("-"),f.shift()=="data"&&(e[a=f.join("-")]=d.getAttribute("data-"+a));return e}else return false},isAcceptedType:function(d){return d instanceof
HTMLElement||d instanceof SVGElement?true:false},setAttribute:function(d,c,b){return d instanceof HTMLElement?(d[c]=b,true):d instanceof SVGElement?(d.setAttribute(c,b),true):false},matches:function(d,c,b){return g.toArray(this.getNodes(d,c)).indexOf(b)>-1}}});
define("Bind.plugin",["Store","Observable","Tools","DomUtils"],function(g,d,c,b){return function(e,d){function a(a){h[a]&&(h[a].forEach(function(a){j.unwatchValue(a)}),delete h[a])}var j=null,i={},l={},h={};this.observers=h;this.setModel=function(a){return a instanceof g?(j=a,true):false};this.getModel=function(){return j};this.ItemRenderer=function(k,d){var e=null,f=null,h=null,i=null,g=null;this.setRenderer=function(a){e=a;return true};this.getRenderer=function(){return e};this.setRootNode=function(a){return b.isAcceptedType(a)?
(h=a,a=h.querySelector("*"),this.setRenderer(a),a&&h.removeChild(a),true):false};this.getRootNode=function(){return h};this.setPlugins=function(a){f=a;return true};this.getPlugins=function(){return f};this.items={};this.setStart=function(a){return i=parseInt(a,10)};this.getStart=function(){return i};this.setNb=function(a){return g=a=="*"?a:parseInt(a,10)};this.getNb=function(){return g};this.addItem=function(a){var b;return typeof a=="number"&&!this.items[a]?(b=this.getNextItem(a),(a=this.create(a))?
(b?h.insertBefore(a,b):h.appendChild(a),true):false):false};this.getNextItem=function(a){var b=Object.keys(this.items).map(function(a){return Number(a)}),k=c.closestGreater(a,b),b=b[k];if(b!=a)return this.items[b]};this.removeItem=function(b){var k=this.items[b];return k?(h.removeChild(k),delete this.items[b],a(b),true):false};this.create=function(a){if(j.has(a)){var k=e.cloneNode(true),d=b.getNodes(k);c.toArray(d).forEach(function(b){b.setAttribute("data-"+f.name+"_id",a)});this.items[a]=k;f.apply(k);
return k}};this.render=function(){var a=g=="*"?j.getNbItems():g,b=[];if(g!==null&&i!==null){c.loop(this.items,function(k,c){c=Number(c);(c<i||c>=i+a||!j.has(c))&&b.push(c)},this);b.sort(c.compareNumbers).reverse().forEach(this.removeItem,this);for(var k=i,d=a+i;k<d;k++)this.addItem(k);return true}else return false};this.setPlugins(k);this.setRootNode(d)};this.setItemRenderer=function(a,b){l[a||"default"]=b};this.getItemRenderer=function(a){return l[a]};this.foreach=function(b,c,d,e){var h=new this.ItemRenderer(this.plugins,
b);h.setStart(d||0);h.setNb(e||"*");h.render();j.watch("added",h.render,h);j.watch("deleted",function(b){h.render();a(b)},this);this.setItemRenderer(c,h)};this.updateStart=function(a,b){var c=this.getItemRenderer(a);return c?(c.setStart(b),true):false};this.updateNb=function(a,b){var c=this.getItemRenderer(a);return c?(c.setNb(b),true):false};this.refresh=function(a){return(a=this.getItemRenderer(a))?(a.render(),true):false};this.bind=function(a,h,d){var d=d||"",e=a.getAttribute("data-"+this.plugins.name+
"_id"),f=d.split("."),i=e||f.shift(),g=e?d:f.join("."),e=c.getNestedProperty(j.get(i),g),l=c.toArray(arguments).slice(3);if(e||e===0||e===false)this.execBinding.apply(this,[a,h,e].concat(l))||b.setAttribute(a,h,e);this.hasBinding(h)||a.addEventListener("change",function(){j.has(i)&&(g?j.update(i,d,a[h]):j.set(i,a[h]))},true);this.observers[i]=this.observers[i]||[];this.observers[i].push(j.watchValue(i,function(d){this.execBinding.apply(this,[a,h,c.getNestedProperty(d,g)].concat(l))||b.setAttribute(a,
h,c.getNestedProperty(d,g))},this))};this.set=function(a){return b.isAcceptedType(a)&&a.name?(j.set(a.name,a.value),true):false};this.getItemIndex=function(a){return(a=b.getDataset(a))&&typeof a[this.plugins.name+"_id"]!="undefined"?+a[this.plugins.name+"_id"]:false};this.form=function(a){if(a&&a.nodeName=="FORM"){var b=this;a.addEventListener("submit",function(d){c.toArray(a.querySelectorAll("[name]")).forEach(b.set,b);d.preventDefault()},true);return true}else return false};this.addBinding=function(a,
b){return a&&typeof a=="string"&&typeof b=="function"?(i[a]=b,true):false};this.execBinding=function(a,b){return this.hasBinding(b)?(i[b].apply(a,Array.prototype.slice.call(arguments,2)),true):false};this.hasBinding=function(a){return i.hasOwnProperty(a)};this.getBinding=function(a){return i[a]};this.addBindings=function(a){return c.loop(a,function(a,b){this.addBinding(b,a)},this)};this.setModel(e);this.addBindings(d)}});
define("Event.plugin",["DomUtils"],function(g){return function(d,c){var b=null,e={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},f=!!c;this.addEventListener=function(a,b,c,d){a.addEventListener(this.map(b),c,!!d)};this.listen=function(a,c,d,e){this.addEventListener(a,c,function(c){b[d].call(b,c,a)},!!e)};this.delegate=function(a,c,d,e,h){this.addEventListener(a,d,function(d){g.matches(a,c,d.target)&&b[e].call(b,d,a)},!!h)};this.getParent=function(){return b};this.setParent=function(a){return a instanceof
Object?(b=a,true):false};this.map=function(a){return f?e[a]||a:a};this.setMap=function(a,b){return typeof a=="string"&&typeof b=="string"?(e[a]=b,true):false};this.setParent(d)}});
define("LocalStore",["Store","Tools"],function(g,d){function c(){var b=null,c=localStorage,f=function(){c.setItem(b,this.toJSON())};this.setLocalStorage=function(a){return a&&a.setItem instanceof Function?(c=a,true):false};this.getLocalStorage=function(){return c};this.sync=function(a){return typeof a=="string"?(b=a,a=JSON.parse(c.getItem(a)),d.loop(a,function(a,b){this.has(b)||this.set(b,a)},this),f.call(this),this.watch("added",f,this),this.watch("updated",f,this),this.watch("deleted",f,this),true):
false}}return function(b){c.prototype=new g(b);return new c}});
define("Plugins",["Tools","DomUtils"],function(g,d){return function(c){var b={},e=function(a){return a.trim()},f=function(a,c,d){c.split(";").forEach(function(c){var h=c.split(":"),c=h[0].trim(),h=h[1]?h[1].split(",").map(e):[];h.unshift(a);b[d]&&b[d][c]&&b[d][c].apply(b[d],h)})};this.add=function(a,c){var d=this;return typeof a=="string"&&typeof c=="object"&&c?(b[a]=c,c.plugins={name:a,apply:function(){return d.apply.apply(d,arguments)}},true):false};this.addAll=function(a){return g.loop(a,function(a,
b){this.add(b,a)},this)};this.get=function(a){return b[a]};this.del=function(a){return delete b[a]};this.apply=function(a){var b;return d.isAcceptedType(a)?(b=d.getNodes(a),g.loop(g.toArray(b),function(a){g.loop(d.getDataset(a),function(b,c){f(a,b,c)})}),a):false};this.addAll(c)}});
define("OObject",["StateMachine","Store","Plugins","DomUtils","Tools"],function(g,d,c,b,e){return function(f){var a=function(a){var c=i||document.createElement("div");if(a.template){typeof a.template=="string"?c.innerHTML=a.template.trim():b.isAcceptedType(a.template)&&c.appendChild(a.template);if(c.childNodes.length>1)throw Error("UI.template should have only one parent node");else a.dom=c.childNodes[0];a.plugins.apply(a.dom)}else throw Error("UI.template must be set prior to render");},j=function(a,
b,c){b&&(c?b.insertBefore(a.dom,c):b.appendChild(a.dom),i=b)},i=null,l=new g("Init",{Init:[["render",a,this,"Rendered"],["place",function(b,c){a(b);j.apply(null,e.toArray(arguments))},this,"Rendered"]],Rendered:[["place",j,this],["render",a,this]]});this.model=f instanceof d?f:new d;this.plugins=new c;this.dom=this.template=null;this.place=function(a,b){l.event("place",this,a,b)};this.render=function(){l.event("render",this)};this.setTemplateFromDom=function(a){return b.isAcceptedType(a)?(this.template=
a,true):false};this.alive=function(a){return b.isAcceptedType(a)?(this.setTemplateFromDom(a),this.place(a.parentNode,a.nextElementSibling),true):false};this.getCurrentPlace=function(){return i}}});
define("Place.plugin",["OObject","Tools"],function(g,d){return function(c){var b={};this.place=function(c,d){if(b[d]instanceof g)b[d].place(c);else throw Error(d+" is not an OObject UI in place:"+d);};this.set=function(c,d){return typeof c=="string"&&d instanceof g?(b[c]=d,true):false};this.setAll=function(b){d.loop(b,function(b,a){this.set(a,b)},this)};this.get=function(c){return b[c]};this.setAll(c)}});
define("SocketIOTransport",["Observable","Tools"],function(){return function(g){var d=null;this.setSocket=function(c){return c&&typeof c.emit=="function"?(d=c,true):false};this.getSocket=function(){return d};this.on=function(c,b){return d.on(c,b)};this.once=function(c,b){return d.once(c,b)};this.emit=function(c,b,e){return d.emit(c,b,e)};this.removeListener=function(c,b,e){return d.removeListener(c,b,e)};this.request=function(c,b,d,f){return typeof c=="string"&&typeof b!="undefined"?(b={eventId:Date.now()+
Math.floor(Math.random()*1E6),data:b},this.once(b.eventId,function(){d&&d.apply(f||null,arguments)}),this.emit(c,b),true):false};this.listen=function(c,b,d,f){if(typeof c=="string"&&typeof b!="undefined"&&typeof d=="function"){var a={eventId:Date.now()+Math.floor(Math.random()*1E6),data:b,keepAlive:true},j=function(){d&&d.apply(f||null,arguments)},g=this;this.on(a.eventId,j);this.emit(c,a);return function(){g.emit("disconnect-"+a.eventId);g.removeListener(a.eventId,j)}}else return false};this.setSocket(g)}});
define("Stack",["Tools"],function(){var g=require("Tools");return function(d){function c(a){if(!(a>=f.length)){var d=f[a];return g.toArray(b.childNodes).indexOf(d)==-1?c(a+1):d}}var b=document.createDocumentFragment(),e=document.createElement("div"),f=[];this.add=function(a){return!this.has(a)&&a instanceof HTMLElement?(b.appendChild(a),f.push(a),a):false};this.remove=function(a){var c;return this.has(a)?(c=f.indexOf(a),b.removeChild(a),f.splice(c,1),a):false};this.place=function(a){return a instanceof
HTMLElement?([].slice.call(b.childNodes).forEach(function(b){this.has(b)&&a.appendChild(b)},this),this._setParent(a)):false};this.up=function(a){if(this.has(a)){var b=this.getPosition(a);this.move(a,b+1);return a}else return false};this.down=function(a){if(this.has(a)){var b=this.getPosition(a);this.move(a,b-1);return a}else return false};this.move=function(a,d){if(this.has(a)){var e=f.indexOf(a);f.splice(e,1);(e=c(d))?b.insertBefore(a,e):b.appendChild(a);f.splice(d,0,a);return a}else return false};
this.insert=function(a,c){return!this.has(a)&&a instanceof HTMLElement?(f.splice(c,0,a),b.insertBefore(a,b.childNodes[c]),a):false};this.getPosition=function(a){return f.indexOf(a)};this.count=function(){return b.childNodes.length};this.has=function(a){return this.getPosition(a)>=0};this.hide=function(a){return this.has(a)?(e.appendChild(a),true):false};this.show=function(a){return this.has(a)&&a.parentNode===e?(this.move(a,f.indexOf(a)),true):false};this.hideAll=function(){f.forEach(this.hide,this)};
this.showAll=function(){f.forEach(this.show,this)};this.getParent=function(){return b};this._setParent=function(a){return a instanceof HTMLElement?b=a:false};this.getHidePlace=function(){return e};this.setHidePlace=function(a){return a instanceof HTMLElement?(e=a,true):false};this._setParent(d)}});
define("LocationRouter",["Router","Tools"],function(g,d){function c(){var b;this.parse=function(b){return b.split("#").pop().split("/")};this.toUrl=function(b){return b.join("/")};this.start=function(){this.clearHistory();this.navigate.apply(this,this.parse(window.location.hash));this.bindOnHashChange();this.bindOnRouteChange()};this.destroy=function(){this.unwatch(b);window.removeEventListener("hashchange",this.boundOnHashChange,true)};this.onHashChange=function(b){this.navigate.apply(this,this.parse(b.newUrl.split("#").pop()))};
this.boundOnHashChange=this.onHashChange.bind(this);this.bindOnHashChange=function(){window.addEventListener("hashchange",this.boundOnHashChange,true)};this.bindOnRouteChange=function(){b=this.watch(this.onRouteChange,this)};this.onRouteChange=function(){window.location.hash=this.toUrl(d.toArray(arguments))}}return function(){c.prototype=new g;return new c}});
