/*
 Olives

 The MIT License (MIT)

 Copyright(c) 2012 Olivier Scherrer <pode.fr@gmail.com> - Olivier Wietrich <olivier.wietrich@gmail.com>
*/
define("Olives/DomUtils",["Tools"],function(){return{getNodes:function(f,i){return f instanceof HTMLElement?(f.parentNode||document.createDocumentFragment().appendChild(f),f.parentNode.querySelectorAll(i||"*")):false}}});define("Olives/Event-plugin",function(){return function(f){this.listen=function(i,g,j,c){i.addEventListener(g,function(a){f[j].call(f,a,i)},c=="true")}}});
define("Olives/LocalStore",["Store","Tools"],function(f,i){function g(){var g=null,c=function(){localStorage.setItem(g,this.toJSON())};this.sync=function(a){return typeof a=="string"?(g=a,a=JSON.parse(localStorage.getItem(a)),i.loop(a,function(a,d){this.has(d)||this.set(d,a)},this),c.call(this),true):false};this.watch("added",c,this);this.watch("updated",c,this);this.watch("deleted",c,this)}return function(i){g.prototype=new f(i);return new g}});
define("Olives/Model-plugin",["Store","Observable","Tools","Olives/DomUtils"],function(f,i,g,j){return function(c,a){var e=null,d={},h={};this.observers={};this.setModel=function(k){return k instanceof f?(e=k,true):false};this.getModel=function(){return e};this.ItemRenderer=function(k,l){var b=null,a=null,d=null,c=null,h=null;this.setRenderer=function(a){b=a;return true};this.getRenderer=function(){return b};this.setRootNode=function(b){return b instanceof HTMLElement?(d=b,b=d.querySelector("*"),
this.setRenderer(b),b&&d.removeChild(b),true):false};this.getRootNode=function(){return d};this.setPlugins=function(b){a=b;return true};this.getPlugins=function(){return a};this.items=new f([]);this.setStart=function(b){return c=parseInt(b,10)};this.getStart=function(){return c};this.setNb=function(b){return h=b=="*"?b:parseInt(b,10)};this.getNb=function(){return h};this.addItem=function(b){var a;return typeof b=="number"&&!this.items.get(b)?(a=this.create(b))?(d.insertBefore(a,this.getNextItem(b)),
true):false:false};this.getNextItem=function(b){return this.items.alter("slice",b+1).filter(function(b){if(b instanceof HTMLElement)return true})[0]};this.removeItem=function(b){var a=this.items.get(b);return a?(d.removeChild(a),this.items.set(b),true):false};this.create=function(k){if(e.has(k)){var d=b.cloneNode(true),l=j.getNodes(d);g.toArray(l).forEach(function(b){b.dataset[a.name+"_id"]=k});this.items.set(k,d);a.apply(d);return d}};this.render=function(){var b=h=="*"?e.getNbItems():h,a=[];if(h!==
null&&c!==null){this.items.loop(function(k,d){(d<c||d>=c+b||!e.has(d))&&a.push(d)},this);a.sort(g.compareNumbers).reverse().forEach(this.removeItem,this);for(var k=c,d=b+c;k<d;k++)this.addItem(k);return true}else return false};this.setPlugins(k);this.setRootNode(l)};this.setItemRenderer=function(a,d){h[a||"default"]=d};this.getItemRenderer=function(a){return h[a]};this.foreach=function(a,d,b,c){var h=new this.ItemRenderer(this.plugins,a);h.setStart(b||0);h.setNb(c||"*");h.render();e.watch("added",
h.render,h);e.watch("deleted",function(b){h.render();this.observers[b]&&this.observers[b].forEach(function(b){e.unwatchValue(b)},this);delete this.observers[b]},this);this.setItemRenderer(d,h)};this.updateStart=function(a,d){var b=this.getItemRenderer(a);return b?(b.setStart(d),true):false};this.updateNb=function(a,d){var b=this.getItemRenderer(a);return b?(b.setNb(d),true):false};this.refresh=function(a){return(a=this.getItemRenderer(a))?(a.render(),true):false};this.bind=function(a,d,b){var b=b||
"",c=a.dataset[this.plugins.name+"_id"],h=b.split("."),f=c||h.shift(),i=c?b:h.join("."),c=g.getNestedProperty(e.get(f),i),j=g.toArray(arguments).slice(3);if(c||c===0||c===false)this.execBinding.apply(this,[a,d,c].concat(j))||(a[d]=c);this.hasBinding(d)||a.addEventListener("change",function(){if(i){var c=e.get(f);g.setNestedProperty(c,b,a[d]);e.set(f,c)}else e.set(f,a[d])},true);this.observers[f]=this.observers[f]||[];this.observers[f].push(e.watchValue(f,function(b){this.execBinding.apply(this,[a,
d,g.getNestedProperty(b,i)].concat(j))||(a[d]=g.getNestedProperty(b,i))},this))};this.set=function(a){return a instanceof HTMLElement&&a.name?(e.set(a.name,a.value),true):false};this.form=function l(l){if(l&&l.nodeName=="FORM"){var b=this;l.addEventListener("submit",function(a){g.toArray(l.querySelectorAll("[name]")).forEach(b.set,b);a.preventDefault()},true);return true}else return false};this.addBinding=function(a,b){return a&&typeof a=="string"&&typeof b=="function"?(d[a]=b,true):false};this.execBinding=
function(a,b){return this.hasBinding(b)?(d[b].apply(a,Array.prototype.slice.call(arguments,2)),true):false};this.hasBinding=function(a){return d.hasOwnProperty(a)};this.getBinding=function(a){return d[a]};this.addBindings=function(a){return g.loop(a,function(a,d){this.addBinding(d,a)},this)};this.setModel(c);this.addBindings(a)}});
define("Olives/OObject",["StateMachine","Store","Olives/Plugins","Olives/DomUtils","Tools"],function(f,i,g,j,c){return function(a){var e=function(a){var b=h||document.createElement("div");if(a.template){typeof a.template=="string"?b.innerHTML=a.template.trim():a.template instanceof HTMLElement&&b.appendChild(a.template);if(b.childNodes.length>1)throw Error("UI.template should have only one parent node");else a.dom=b.childNodes[0];a.plugins.apply(a.dom)}else throw Error("UI.template must be set prior to render");
},d=function b(a,b,d){b&&(b.insertBefore(a.dom,d),h=b)},h=null,k=new f("Init",{Init:[["render",e,this,"Rendered"],["place",function(a,h){e(a);d.apply(null,c.toArray(arguments))},this,"Rendered"]],Rendered:[["place",d,this],["render",e,this]]});this.model=a instanceof i?a:new i;this.plugins=new g;this.dom=this.template=null;this.place=function(a,d){k.event("place",this,a,d)};this.render=function(){k.event("render",this)};this.setTemplateFromDom=function(a){return a instanceof HTMLElement?(this.template=
a,true):false};this.alive=function(a){return a instanceof HTMLElement?(this.setTemplateFromDom(a),this.place(a.parentNode,a.nextElementSibling),true):false}}});
define("Olives/Plugins",["Tools","Olives/DomUtils"],function(f,i){return function(){var g={},j=function(a){return a.trim()},c=function(a,c,d){c.split(";").forEach(function(c){var e=c.split(":"),c=e[0].trim(),e=e[1]?e[1].split(",").map(j):[];e.unshift(a);g[d]&&g[d][c]&&g[d][c].apply(g[d],e)})};this.add=function(a,c){var d=this;return typeof a=="string"&&typeof c=="object"&&c?(g[a]=c,c.plugins={name:a,apply:function(){return d.apply.apply(d,arguments)}},true):false};this.addAll=function(a){return f.loop(a,
function(a,d){this.add(d,a)},this)};this.get=function(a){return g[a]};this.del=function(a){return delete g[a]};this.apply=function(a){var e;return a instanceof HTMLElement?(e=i.getNodes(a),f.loop(f.toArray(e),function(a){f.loop(a.dataset,function(h,e){c(a,h,e)})}),a):false}}});
define("Olives/Transport",["Observable","Tools"],function(f,i){return function(g,j){var c=null,a=null,e=new f;this.setIO=function(d){return d&&typeof d.connect=="function"?(a=d,true):false};this.getIO=function(){return a};this.connect=function(d){return typeof d=="string"?(c=a.connect(d),true):false};this.getSocket=function(){return c};this.on=function(a,h){c.on(a,h)};this.once=function(a,h){c.once(a,h)};this.emit=function(a,h,e){c.emit(a,h,e)};this.request=function(a,e,f,g){var b=Date.now()+Math.floor(Math.random()*
1E6),i=function(){f&&f.apply(g||null,arguments)};c[e.keptAlive?"on":"once"](b,i);e.__eventId__=b;c.emit(a,e);if(e.keptAlive)return function(){c.emit("disconnect-"+b);c.removeListener(b,i)}};this.listen=function(a,c,f,g){var b=a+"/"+c.path,j,m;e.hasTopic(b)||(i.mixin({method:"GET",keptAlive:true},c),m=this.request(a,c,function(a){e.notify(b,a)},this));j=e.watch(b,f,g);return function(){e.unwatch(j);e.hasTopic(b)||m()}};this.getListenObservable=function(){return e};this.setIO(g);this.connect(j)}});
define("Olives/UI-plugin",["Olives/OObject","Tools"],function(f,i){return function(g){var j={};this.place=function(c,a){if(j[a]instanceof f)j[a].place(c);else throw Error(a+" is not an OObject UI in place:"+a);};this.set=function(c,a){return typeof c=="string"&&a instanceof f?(j[c]=a,true):false};this.setAll=function(c){i.loop(c,function(a,c){this.set(c,a)},this)};this.get=function(c){return j[c]};this.setAll(g)}});
