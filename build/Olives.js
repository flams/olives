/*
 Olives ${VERSION} http://flams.github.com/olives
 The MIT License (MIT)
 Copyright (c) 2012 Olivier Scherrer <pode.fr@gmail.com> - Olivier Wietrich <olivier.wietrich@gmail.com>
*/
define("Olives/DomUtils",function(){return{getNodes:function(c,g){return this.isAcceptedType(c)?(c.parentNode||document.createDocumentFragment().appendChild(c),c.parentNode.querySelectorAll(g||"*")):false},getDataset:function(c){var g=0,h,i={},d,b;if(this.isAcceptedType(c))if(c.hasOwnProperty("dataset"))return c.dataset;else{for(h=c.attributes.length;g<h;g++)d=c.attributes[g].name.split("-"),d.shift()=="data"&&(i[b=d.join("-")]=c.getAttribute("data-"+b));return i}else return false},isAcceptedType:function(c){return c instanceof
HTMLElement||c instanceof SVGElement?true:false},setAttribute:function(c,g,h){return c instanceof HTMLElement?(c[g]=h,true):c instanceof SVGElement?(c.setAttribute(g,h),true):false}}});define("Olives/Event-plugin",function(){return function(c){this.listen=function(g,h,i,d){g.addEventListener(h,function(b){c[i].call(c,b,g)},d=="true")}}});
define("Olives/LocalStore",["Store","Tools"],function(c,g){function h(){var c=null,d=localStorage,b=function(){d.setItem(c,this.toJSON())};this.setLocalStorage=function(f){return f&&f.setItem instanceof Function?(d=f,true):false};this.getLocalStorage=function(){return d};this.sync=function(f){return typeof f=="string"?(c=f,f=JSON.parse(d.getItem(f)),g.loop(f,function(f,b){this.has(b)||this.set(b,f)},this),b.call(this),this.watch("added",b,this),this.watch("updated",b,this),this.watch("deleted",b,
this),true):false}}return function(i){h.prototype=new c(i);return new h}});
define("Olives/Model-plugin",["Store","Observable","Tools","Olives/DomUtils"],function(c,g,h,i){return function(d,b){var f=null,g={},j={};this.observers={};this.setModel=function(a){return a instanceof c?(f=a,true):false};this.getModel=function(){return f};this.ItemRenderer=function(a,k){var e=null,b=null,d=null,j=null,g=null;this.setRenderer=function(a){e=a;return true};this.getRenderer=function(){return e};this.setRootNode=function(a){return i.isAcceptedType(a)?(d=a,a=d.querySelector("*"),this.setRenderer(a),
a&&d.removeChild(a),true):false};this.getRootNode=function(){return d};this.setPlugins=function(a){b=a;return true};this.getPlugins=function(){return b};this.items=new c([]);this.setStart=function(a){return j=parseInt(a,10)};this.getStart=function(){return j};this.setNb=function(a){return g=a=="*"?a:parseInt(a,10)};this.getNb=function(){return g};this.addItem=function(a){var e;return typeof a=="number"&&!this.items.get(a)?(e=this.create(a))?((a=this.getNextItem(a))?d.insertBefore(e,a):d.appendChild(e),
true):false:false};this.getNextItem=function(a){return this.items.alter("slice",a+1).filter(function(a){if(i.isAcceptedType(a))return true})[0]};this.removeItem=function(a){var e=this.items.get(a);return e?(d.removeChild(e),this.items.set(a),true):false};this.create=function(a){if(f.has(a)){var k=e.cloneNode(true),d=i.getNodes(k);h.toArray(d).forEach(function(e){e.setAttribute("data-"+b.name+"_id",a)});this.items.set(a,k);b.apply(k);return k}};this.render=function(){var a=g=="*"?f.getNbItems():g,
e=[];if(g!==null&&j!==null){this.items.loop(function(k,b){(b<j||b>=j+a||!f.has(b))&&e.push(b)},this);e.sort(h.compareNumbers).reverse().forEach(this.removeItem,this);for(var k=j,b=a+j;k<b;k++)this.addItem(k);return true}else return false};this.setPlugins(a);this.setRootNode(k)};this.setItemRenderer=function(a,b){j[a||"default"]=b};this.getItemRenderer=function(a){return j[a]};this.foreach=function(a,b,e,d){var c=new this.ItemRenderer(this.plugins,a);c.setStart(e||0);c.setNb(d||"*");c.render();f.watch("added",
c.render,c);f.watch("deleted",function(a){c.render();this.observers[a]&&this.observers[a].forEach(function(a){f.unwatchValue(a)},this);delete this.observers[a]},this);this.setItemRenderer(b,c)};this.updateStart=function(a,b){var e=this.getItemRenderer(a);return e?(e.setStart(b),true):false};this.updateNb=function(a,b){var e=this.getItemRenderer(a);return e?(e.setNb(b),true):false};this.refresh=function(a){return(a=this.getItemRenderer(a))?(a.render(),true):false};this.bind=function(a,b,e){var e=e||
"",c=a.getAttribute("data-"+this.plugins.name+"_id"),d=e.split("."),j=c||d.shift(),g=c?e:d.join("."),c=h.getNestedProperty(f.get(j),g),l=h.toArray(arguments).slice(3);if(c||c===0||c===false)this.execBinding.apply(this,[a,b,c].concat(l))||i.setAttribute(a,b,c);this.hasBinding(b)||a.addEventListener("change",function(){f.has(j)&&(g?f.update(j,e,a[b]):f.set(j,a[b]))},true);this.observers[j]=this.observers[j]||[];this.observers[j].push(f.watchValue(j,function(e){this.execBinding.apply(this,[a,b,h.getNestedProperty(e,
g)].concat(l))||i.setAttribute(a,b,h.getNestedProperty(e,g))},this))};this.set=function(a){return i.isAcceptedType(a)&&a.name?(f.set(a.name,a.value),true):false};this.form=function k(k){if(k&&k.nodeName=="FORM"){var b=this;k.addEventListener("submit",function(c){h.toArray(k.querySelectorAll("[name]")).forEach(b.set,b);c.preventDefault()},true);return true}else return false};this.addBinding=function(b,e){return b&&typeof b=="string"&&typeof e=="function"?(g[b]=e,true):false};this.execBinding=function(b,
e){return this.hasBinding(e)?(g[e].apply(b,Array.prototype.slice.call(arguments,2)),true):false};this.hasBinding=function(b){return g.hasOwnProperty(b)};this.getBinding=function(b){return g[b]};this.addBindings=function(b){return h.loop(b,function(b,c){this.addBinding(c,b)},this)};this.setModel(d);this.addBindings(b)}});
define("Olives/OObject",["StateMachine","Store","Olives/Plugins","Olives/DomUtils","Tools"],function(c,g,h,i,d){return function(b){var f=function(a){var b=j||document.createElement("div");if(a.template){typeof a.template=="string"?b.innerHTML=a.template.trim():i.isAcceptedType(a.template)&&b.appendChild(a.template);if(b.childNodes.length>1)throw Error("UI.template should have only one parent node");else a.dom=b.childNodes[0];a.plugins.apply(a.dom)}else throw Error("UI.template must be set prior to render");
},l=function e(a,e,b){e&&(b?e.insertBefore(a.dom,b):e.appendChild(a.dom),j=e)},j=null,a=new c("Init",{Init:[["render",f,this,"Rendered"],["place",function(a,b){f(a);l.apply(null,d.toArray(arguments))},this,"Rendered"]],Rendered:[["place",l,this],["render",f,this]]});this.model=b instanceof g?b:new g;this.plugins=new h;this.dom=this.template=null;this.place=function(b,c){a.event("place",this,b,c)};this.render=function(){a.event("render",this)};this.setTemplateFromDom=function(a){return i.isAcceptedType(a)?
(this.template=a,true):false};this.alive=function(a){return i.isAcceptedType(a)?(this.setTemplateFromDom(a),this.place(a.parentNode,a.nextElementSibling),true):false};this.getCurrentPlace=function(){return j}}});
define("Olives/Plugins",["Tools","Olives/DomUtils"],function(c,g){return function(){var h={},i=function(b){return b.trim()},d=function(b,c,d){c.split(";").forEach(function(c){var a=c.split(":"),c=a[0].trim(),a=a[1]?a[1].split(",").map(i):[];a.unshift(b);h[d]&&h[d][c]&&h[d][c].apply(h[d],a)})};this.add=function(b,c){var d=this;return typeof b=="string"&&typeof c=="object"&&c?(h[b]=c,c.plugins={name:b,apply:function(){return d.apply.apply(d,arguments)}},true):false};this.addAll=function(b){return c.loop(b,
function(b,c){this.add(c,b)},this)};this.get=function(b){return h[b]};this.del=function(b){return delete h[b]};this.apply=function(b){var f;return g.isAcceptedType(b)?(f=g.getNodes(b),c.loop(c.toArray(f),function(b){c.loop(g.getDataset(b),function(c,a){d(b,c,a)})}),b):false}}});
define("Olives/Transport",["Observable","Tools"],function(c,g){return function(h,i){var d=null,b=null,f=new c,l={};this.setIO=function(c){return c&&typeof c.connect=="function"?(b=c,true):false};this.getIO=function(){return b};this.connect=function(c){return typeof c=="string"?(d=b.connect(c),true):false};this.getSocket=function(){return d};this.on=function(b,a){d.on(b,a)};this.once=function(b,a){d.once(b,a)};this.emit=function(b,a,c){d.emit(b,a,c)};this.request=function(b,a,c,e){var f=Date.now()+
Math.floor(Math.random()*1E6),g=function(){c&&c.apply(e||null,arguments)};d[a.__keepalive__?"on":"once"](f,g);a.__eventId__=f;d.emit(b,a);if(a.__keepalive__)return function(){d.emit("disconnect-"+f);d.removeListener(f,g)}};this.listen=function(b,a,c,d){var h=b+"/"+a.path,i;f.hasTopic(h)||(g.mixin({method:"GET",__keepalive__:true},a),l[h]=this.request(b,a,function(a){f.notify(h,a)},this));i=f.watch(h,c,d);return function(){f.unwatch(i);if(!f.hasTopic(h))l[h]()}};this.getStopFunctions=function(){return l};
this.getListenObservable=function(){return f};this.setIO(h);this.connect(i)}});define("Olives/UI-plugin",["Olives/OObject","Tools"],function(c,g){return function(h){var i={};this.place=function(d,b){if(i[b]instanceof c)i[b].place(d);else throw Error(b+" is not an OObject UI in place:"+b);};this.set=function(d,b){return typeof d=="string"&&b instanceof c?(i[d]=b,true):false};this.setAll=function(c){g.loop(c,function(b,c){this.set(c,b)},this)};this.get=function(c){return i[c]};this.setAll(h)}});
